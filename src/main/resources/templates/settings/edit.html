<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Profil użytkownika</title>
    <link rel="stylesheet" th:href="@{/css/settings.css}" />
</head>
<body>

<!-- Pasek jak w firms/fakturach: breadcrumbs + tytuł -->
<header class="page-header">
    <nav class="breadcrumbs" aria-label="breadcrumb">
        <a th:href="@{/}" class="crumb">Strona główna</a>
        <span class="sep">/</span>
        <a th:href="@{/users}" class="crumb">Pracownicy</a>
        <span class="sep">/</span>
        <span class="crumb current">Ustawienia użytkownika</span>
    </nav>
    <h1 class="page-title">Ustawienia użytkownika</h1>
</header>

<div class="top-row">
    <div class="side-by-side profile-layout">
        <!-- LEWA KOLUMNA: DANE UŻYTKOWNIKA -->
        <div class="container">
            <div class="form-header">
                <label class="form-title">Twoje dane</label>
            </div>

            <form th:action="@{/users/edit}" th:object="${user}" method="post" class="profile-form" novalidate>
                <input type="hidden" th:field="*{id}" />

                <label for="firstname">Imię</label>
                <input type="text" id="firstname" th:field="*{firstname}" placeholder="Wpisz imię" required />

                <label for="lastName">Nazwisko</label>
                <input type="text" id="lastName" th:field="*{lastName}" placeholder="Wpisz nazwisko" required />

                <label for="email">E‑mail</label>
                <input type="email" id="email" th:field="*{email}" placeholder="np. jan.kowalski@example.com" required />

                <label for="phone">Telefon</label>
                <input type="text" id="phone" th:field="*{phone}" placeholder="np. 500600700" inputmode="numeric" />

                <label for="description">Opis</label>
                <textarea id="description" th:field="*{description}" placeholder="Krótka informacja o Tobie (opcjonalnie)"></textarea>

                <!-- Adres: osobne pola nr budynku i nr lokalu -->
                <fieldset class="address-fieldset">
                    <legend>Adres</legend>
                    <div class="grid-2">
                        <div>
                            <label for="country">Kraj</label>
                            <input type="text" id="country" th:field="*{address.country}" placeholder="np. Polska" />
                        </div>
                        <div>
                            <label for="city">Miasto</label>
                            <input type="text" id="city" th:field="*{address.city}" placeholder="np. Warszawa" />
                        </div>
                        <div>
                            <label for="postalCode">Kod pocztowy</label>
                            <input type="text" id="postalCode" th:field="*{address.postalCode}" placeholder="00-000" />
                        </div>
                        <div>
                            <label for="street">Ulica</label>
                            <input type="text" id="street" th:field="*{address.street}" placeholder="np. Prosta" />
                        </div>
                        <div>
                            <label for="buildingNumber">Nr budynku</label>
                            <input type="text" id="buildingNumber" th:field="*{address.buildingNumber}" placeholder="np. 12" />
                        </div>
                        <div>
                            <label for="apartmentNumber">Nr lokalu</label>
                            <input type="text" id="apartmentNumber" th:field="*{address.apartmentNumber}" placeholder="np. 3" />
                        </div>
                    </div>
                </fieldset>

                <!-- Zmiana hasła -->
                <fieldset class="password-fieldset">
                    <legend>Zmiana hasła</legend>
                    <label class="toggle-password">
                        <input id="changePassword" type="checkbox" />
                        <span>Chcę zmienić hasło</span>
                    </label>

                    <div id="passwordFields" class="password-fields hidden">
                        <label for="newPassword">Nowe hasło</label>
                        <input type="password" id="newPassword" name="newPassword" placeholder="Wpisz nowe hasło" minlength="8" />

                        <label for="confirmPassword">Powtórz nowe hasło</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Powtórz nowe hasło" minlength="8" />
                        <div class="hint">Hasło pozostanie niezmienione, jeśli nie zaznaczysz opcji powyżej.</div>
                    </div>
                </fieldset>

                <!-- Rola (readonly) -->
                <label>Rola</label>
                <input type="text" th:value="${user.role}" readonly class="readonly" aria-readonly="true"/>

                <div class="buttons">
                    <button type="submit" class="submit-btn">Zapisz zmiany</button>
                    <button type="reset" class="btn-cancel">Wyczyść</button>
                </div>

                <div class="hint">Pola z gwiazdką są wymagane.</div>
            </form>
        </div>

        <!-- PRAWA KOLUMNA: ZADANIA -->
        <div class="container">
            <div class="table-header">
                <label class="table-title">Wykonywane prace</label>

                <div class="tasks-tools">
                    <input id="taskSearch" class="table-search" type="search" placeholder="Szukaj po nazwie/opisie…" />
                    <label class="toggle-only-inprogress">
                        <input id="onlyInProgress" type="checkbox" />
                        <span>Tylko „w trakcie”</span>
                    </label>
                </div>
            </div>

            <table class="w1200 tasks-table">
                <thead>
                <tr>
                    <th class="w20">Nazwa</th>
                    <th class="w30">Opis</th>
                    <th class="w10">Data od</th>
                    <th class="w10">Data do</th>
                    <th class="w10">Status</th>
                    <th class="w15">Zasoby</th>
                </tr>
                </thead>
                <tbody id="tasksTbody">
                <tr th:each="task : ${tasks}"
                    th:attr="data-name=${task.name}, data-desc=${task.description}, onclick=|window.location.href='/tasks/edit/${task.id}'|"
                    th:classappend="${task.status != null and task.status.toString() == 'IN_PROGRESS'} ? 'row--in-progress' : ''"
                    class="clickable-row">

                    <td th:text="${task.name}"></td>
                    <td th:text="${task.description}"></td>
                    <td th:text="${task.dateFrom}"></td>
                    <td th:text="${task.dateTo}"></td>
                    <td>
                        <span class="status-badge"
                              th:text="${task.status != null ? task.status : 'UNKNOWN'}"
                              th:classappend="${task.status != null} ? ${' status-' + task.status.toString().toLowerCase()} : ' status-unknown'">
                        </span>
                    </td>
                    <td>
                        <div class="resources">
                            <div class="res-row">
                                <span class="res-label">Pracownicy:</span>
                                <span class="res-values">
                                    <span th:each="u, uiStat : ${task.users}"
                                          th:text="${u.firstname + ' ' + u.lastName + (uiStat.last ? '' : ', ')}"></span>
                                </span>
                            </div>
                            <div class="res-row">
                                <span class="res-label">Auta:</span>
                                <span class="res-values">
                                    <span th:each="car, ciStat : ${task.cars}"
                                          th:text="${car.name + (ciStat.last ? '' : ', ')}"></span>
                                </span>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

            <div class="legend">
                <span class="legend-item">
                    <span class="legend-dot legend-inprogress"></span> W trakcie
                </span>
                <span class="legend-item">
                    <span class="legend-dot legend-completed"></span> Zakończone
                </span>
                <span class="legend-item">
                    <span class="legend-dot legend-planned"></span> Zaplanowane
                </span>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/settings.js}"></script>
</body>
</html>