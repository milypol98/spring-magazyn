<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Profil użytkownika</title>
    <link rel="stylesheet" th:href="@{/css/general.css}" />
</head>
<body>

<!-- Pasek jak w firms/fakturach: breadcrumbs + tytuł -->
<header class="page-header">
    <nav class="breadcrumbs" aria-label="breadcrumb">
        <a th:href="@{/}" class="crumb">Strona główna</a>
        <span class="sep">/</span>
        <a th:href="@{/users}" class="crumb">Pracownicy</a>
        <span class="sep">/</span>
        <span class="crumb current">Ustawienia użytkownika</span>
    </nav>
    <h1 class="page-title">Ustawienia użytkownika</h1>
</header>

<div class="top-row">
    <section class="side-by-side ">
        <div class="section-box span-2">
            <form th:action="@{/users/add}"
                  th:object="${user}"
                  method="post">

                <div th:if="${#fields.hasErrors()}" class="flash" style="border-color:#fca5a5;background:#fef2f2;color:#991b1b;">
                    Popraw zaznaczone pola formularza.
                </div>

                <div class="form-grid">

                    <div class="field">
                        <label for="firstname">Imię <span class="req">*</span></label>
                        <input id="firstname" type="text" th:field="*{firstname}" placeholder="np. Jan" required />
                        <div class="error" th:if="${#fields.hasErrors('firstname')}" th:errors="*{firstname}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="lastName">Nazwisko <span class="req">*</span></label>
                        <input id="lastName" type="text" th:field="*{lastName}" placeholder="np. Kowalski" required />
                        <div class="error" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="email">E-mail <span class="req">*</span></label>
                        <input id="email" type="email" th:field="*{email}" placeholder="np. jan.kowalski@example.com" required />
                        <div class="error" th:if="${#fields.hasErrors('email')}" th:errors="*{email}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="phone">Telefon</label>
                        <input id="phone" type="text" th:field="*{phone}" placeholder="+48 500 600 700" />
                        <div class="error" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}">Błąd</div>
                    </div>

                    <div class="field span-2">
                        <label for="description">Opis</label>
                        <textarea id="description" th:field="*{description}" rows="4" placeholder="Krótka informacja o użytkowniku..."></textarea>
                        <div class="error" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">Błąd</div>
                    </div>

                    <div class="section-box span-2">
                        <div class="section-header">Adres</div>
                        <div class="subgrid">
                            <div class="field">
                                <label for="address.street">Ulica</label>
                                <input id="address.street" type="text" th:field="*{address.street}" placeholder="np. Prosta" />
                                <div class="error" th:if="${#fields.hasErrors('address.street')}" th:errors="*{address.street}">Błąd</div>
                            </div>

                            <div class="field">
                                <label for="address.buildingNumber">Nr budynku</label>
                                <input id="address.buildingNumber" type="text" th:field="*{address.buildingNumber}" placeholder="12" />
                                <div class="error" th:if="${#fields.hasErrors('address.buildingNumber')}" th:errors="*{address.buildingNumber}">Błąd</div>
                            </div>

                            <div class="field">
                                <label for="address.apartmentNumber">Nr lokalu</label>
                                <input id="address.apartmentNumber" type="text" th:field="*{address.apartmentNumber}" placeholder="3" />
                                <div class="error" th:if="${#fields.hasErrors('address.apartmentNumber')}" th:errors="*{address.apartmentNumber}">Błąd</div>
                            </div>

                            <div class="field">
                                <label for="address.postalCode">Kod pocztowy</label>
                                <input id="address.postalCode" type="text" th:field="*{address.postalCode}" placeholder="00-000" />
                                <div class="error" th:if="${#fields.hasErrors('address.postalCode')}" th:errors="*{address.postalCode}">Błąd</div>
                            </div>

                            <div class="field">
                                <label for="address.city">Miejscowość</label>
                                <input id="address.city" type="text" th:field="*{address.city}" placeholder="np. Warszawa" />
                                <div class="error" th:if="${#fields.hasErrors('address.city')}" th:errors="*{address.city}">Błąd</div>
                            </div>

                            <div class="field">
                                <label for="address.country">Kraj</label>
                                <input id="address.country" type="text" th:field="*{address.country}" placeholder="np. Polska" />
                                <div class="error" th:if="${#fields.hasErrors('address.country')}" th:errors="*{address.country}">Błąd</div>
                            </div>
                        </div>
                    </div>

                    <div th:if="${user?.id != null}" class="section-box span-2">
                        <div class="section-header">Zmiana hasła</div>
                        <div class="subgrid">
                            <div class="field">
                                <label for="newPassword">Nowe hasło</label>
                                <input type="password" id="newPassword" name="newPassword" placeholder="Wpisz nowe hasło" minlength="8" />
                            </div>
                            <div class="field">
                                <label for="confirmPassword">Powtórz nowe hasło</label>
                                <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Powtórz nowe hasło" minlength="8" />
                            </div>
                            <div class="span-2" style="font-size: 0.9em; color: #666;">
                                Pozostaw puste, jeśli nie chcesz zmieniać hasła.
                            </div>
                        </div>
                    </div>

                    <div class="field">
                        <label for="role">Rola</label>
                        <input id="role" type="text" th:value="${user.role}" readonly disabled />
                    </div>

                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary"
                            th:text="${user?.id} != null ? 'Zapisz zmiany' : 'Utwórz użytkownika'">Zapisz</button>
                    <a th:href="@{/users}" class="btn btn-secondary">Anuluj</a>
                </div>
            </form>
        </div>

        <!-- PRAWA KOLUMNA: ZADANIA -->
        <div class="section-box span-2">
            <div class="table-header">
                <label class="table-title">Wykonywane prace</label>
                <input type="search" class="table-search" placeholder="Szukaj..." data-target-table="#userTaskTable">
            </div>
            <div class="table-wrapper">
                <table id="userTaskTable" class="table">
                    <thead>
                    <tr>
                        <th >Nazwa</th>
                        <th >Opis</th>
                        <th >Data od</th>
                        <th >Data do</th>
                        <th >Status</th>
                        <th >Zasoby</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="task : ${tasks}"
                        th:attr="data-name=${task.name}, data-desc=${task.description}, onclick=|window.location.href='/tasks/edit/${task.id}'|"
                        th:classappend="${task.status != null and task.status.toString() == 'IN_PROGRESS'} ? 'row--in-progress' : ''"
                        class="clickable-row">

                        <td th:text="${task.name}"></td>
                        <td th:text="${task.description}"></td>
                        <td th:text="${task.dateFrom}"></td>
                        <td th:text="${task.dateTo}"></td>
                        <td>
                        <span class="status-badge"
                              th:text="${task.status != null ? task.status : 'UNKNOWN'}"
                              th:classappend="${task.status != null} ? ${' status-' + task.status.toString().toLowerCase()} : ' status-unknown'">
                        </span>
                        </td>
                        <td>
                            <div class="resources">
                                <div class="res-row">
                                    <span class="res-label">Pracownicy:</span>
                                    <span class="res-values">
                                    <span th:each="u, uiStat : ${task.users}"
                                          th:text="${u.firstname + ' ' + u.lastName + (uiStat.last ? '' : ', ')}"></span>
                                </span>
                                </div>
                                <div class="res-row">
                                    <span class="res-label">Auta:</span>
                                    <span class="res-values">
                                    <span th:each="car, ciStat : ${task.cars}"
                                          th:text="${car.name + (ciStat.last ? '' : ', ')}"></span>
                                </span>
                                </div>
                            </div>
                        </td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(tasks)}">
                        <td colspan="15">Brak zadań do wyświetlenia.</td>
                    </tr>
                    </tbody>
                </table>

<!--                <div class="legend">-->
<!--                <span class="legend-item">-->
<!--                    <span class="legend-dot legend-inprogress"></span> W trakcie-->
<!--                </span>-->
<!--                    <span class="legend-item">-->
<!--                    <span class="legend-dot legend-completed"></span> Zakończone-->
<!--                </span>-->
<!--                    <span class="legend-item">-->
<!--                    <span class="legend-dot legend-planned"></span> Zaplanowane-->
<!--                </span>-->
<!--                </div>-->
            </div>
        </div>
    </section>
</div>

<script th:src="@{/js/general.js}"></script>
<script th:src="@{/js/settings.js}"></script>

</body>
</html>