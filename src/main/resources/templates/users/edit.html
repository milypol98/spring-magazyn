<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Profil użytkownika</title>
    <link rel="stylesheet" th:href="@{/css/general.css}" />
</head>
<body>

<!-- Pasek jak w firms/fakturach: breadcrumbs + tytuł -->
<header class="page-header">
    <nav class="breadcrumbs" aria-label="breadcrumb">
        <a th:href="@{/dashboard}" class="crumb">Strona główna</a>
        <span class="sep">/</span>
        <span class="crumb current">Ustawienia użytkownika</span>
    </nav>
    <h1 class="page-title">Ustawienia użytkownika</h1>
</header>


<section class="side-by-side ">
    <div class="section-box span-2">
        <form th:action="@{/users/save}" th:object="${updateRequest}" method="post">
            <div th:if="${#fields.hasErrors()}" class="flashError">
                Popraw zaznaczone pola formularza.
            </div>
            <div th:if="${successMessage}" class="flash">
                <p th:text="${successMessage}"></p>
            </div>

            <div th:if="${errorMessage}" class="flashError">
                <p th:text="${errorMessage}"></p>
            </div>
            <div class="form-grid">
                <div class="field">
                    <label for="firstname">Imię <span class="req">*</span></label>
                    <input id="firstname" type="text" th:field="*{firstname}" placeholder="np. Jan" required />
                    <div class="error" th:if="${#fields.hasErrors('firstname')}" th:errors="*{firstname}">Błąd</div>
                </div>

                <div class="field">
                    <label for="lastName">Nazwisko <span class="req">*</span></label>
                    <input id="lastName" type="text" th:field="*{lastName}" placeholder="np. Kowalski" required />
                    <div class="error" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}">Błąd</div>
                </div>

                <div class="field">
                    <label for="phone">Telefon</label>
                    <input id="phone" type="text" th:field="*{phone}" placeholder="+48 500 600 700" />
                </div>

                <div class="field span-2">
                    <label for="description">Opis</label>
                    <textarea id="description" th:field="*{description}" rows="4" placeholder="Krótka informacja o użytkowniku..."></textarea>
                </div>

                <div class="section-box span-2">
                    <div class="section-header">Adres</div>
                    <div class="subgrid">
                        <div class="field">
                            <label for="address.street">Ulica</label>
                            <input id="address.street" type="text" th:field="*{address.street}" placeholder="np. Prosta" />
                        </div>

                        <div class="field">
                            <label for="address.buildingNumber">Nr budynku</label>
                            <input id="address.buildingNumber" type="text" th:field="*{address.buildingNumber}" placeholder="12" />
                        </div>

                        <div class="field">
                            <label for="address.apartmentNumber">Nr lokalu</label>
                            <input id="address.apartmentNumber" type="text" th:field="*{address.apartmentNumber}" placeholder="3" />
                        </div>

                        <div class="field">
                            <label for="address.postalCode">Kod pocztowy</label>
                            <input id="address.postalCode" type="text" th:field="*{address.postalCode}" placeholder="00-000" />
                            <div class="error" th:if="${#fields.hasErrors('address.postalCode')}" th:errors="*{address.postalCode}">Błąd</div>
                        </div>

                        <div class="field">
                            <label for="address.city">Miejscowość</label>
                            <input id="address.city" type="text" th:field="*{address.city}" placeholder="np. Warszawa" />
                        </div>

                        <div class="field">
                            <label for="address.country">Kraj</label>
                            <input id="address.country" type="text" th:field="*{address.country}" placeholder="np. Polska" />
                        </div>
                    </div>

                </div>
                <div class="section-box span-2">
                    <div class="section-header">Zmiana hasła</div>

                    <div class="field">
                        <label for="currentPassword">Wpisz obecne hasło</label>
                        <input type="password" id="currentPassword" th:field="*{currentPassword}" placeholder="Wpisz obecne hasło"/>
                        <div class="error" th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}"></div>
                    </div>

                    <div class="field">
                        <label for="newPassword">Nowe hasło</label>
                        <input type="password" id="newPassword" th:field="*{newPassword}" placeholder="Wpisz nowe hasło" />
                        <div class="error" th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}"></div>
                    </div>

                    <div class="field">
                        <label for="confirmPassword">Powtórz nowe hasło</label>
                        <input type="password" id="confirmPassword" th:field="*{confirmPassword}" placeholder="Powtórz nowe hasło" />
                        <div class="error" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>
                    </div>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Zapisz</button>
                <a th:href="@{/dashboard}" class="btn btn-secondary">Anuluj</a>
            </div>
        </form>
    </div>

    <div class="section-box span-2">
        <div class="table-header">
            <label class="table-title">Wykonywane prace</label>
            <input type="search" class="table-search" placeholder="Szukaj..." data-target-table="#userTaskTable">
        </div>
        <div class="table-wrapper">
            <table id="userTaskTable" class="table">
                <thead>
                <tr>
                    <th >L.P.</th>
                    <th >Nazwa</th>
                    <th >Opis</th>
                    <th >Data od</th>
                    <th >Data do</th>
                    <th >Status</th>
                    <th >Zasoby</th>
                    <th >Akcja</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="task, i : ${tasks}">
                    <td th:text="${i.count}">1</td>
                    <td th:text="${task.name}"></td>
                    <td th:text="${task.description}"></td>
                    <td th:text="${task.dateFrom}"></td>
                    <td th:text="${task.dateTo}"></td>
                    <td>
                        <span class="status-badge"
                              th:text="${task.status != null ? task.status.displayName : 'UNKNOWN'}">
                        </span>
                    </td>
                    <td>
                        <div class="resources">
                            <div class="res-row">
                                <span class="res-label">Pracownicy:</span>
                                <span class="res-values">
                                    <span th:each="u, uiStat : ${task.users}"
                                          th:text="${u.firstname + ' ' + u.lastName + (uiStat.last ? '' : ', ')}"></span>
                                </span>
                            </div>
                            <div class="res-row">
                                <span class="res-label">Auta:</span>
                                <span class="res-values">
                                    <span th:each="car, ciStat : ${task.cars}"
                                          th:text="${car.name + (ciStat.last ? '' : ', ')}"></span>
                                </span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <a class="btn btn-small" th:href="@{/tasks/{id}(id=${task.id})}">Szczegóły</a>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(tasks)}">
                    <td colspan="15">Brak zadań do wyświetlenia.</td>
                </tr>
                </tbody>
            </table>

        </div>
    </div>
</section>
<script th:src="@{/js/general.js}"></script>

</body>
</html>