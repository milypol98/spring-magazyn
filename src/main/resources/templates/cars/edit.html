<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8">
    <title th:text="${car.id} != null ? 'Edytuj pojazd' : 'Dodaj pojazd'">Pojazd</title>
    <link rel="stylesheet" th:href="@{/css/general.css}" />
</head>
<body>

<header class="page-header">
    <nav class="breadcrumbs" aria-label="breadcrumb">
        <a th:href="@{/dashboard}" class="crumb">Strona główna</a>
        <span class="sep">/</span>
        <a th:href="@{/cars}" class="crumb">Pojazdy</a>
        <span class="sep">/</span>
        <span class="crumb current" th:text="${car.id} != null ? 'Edycja' : 'Nowy pojazd'">Edycja</span>
    </nav>
    <div class="header-row">
        <h1 class="page-title" th:text="${car.id} != null ? 'Edytuj pojazd' : 'Dodaj pojazd'">Pojazd</h1>
        <div class="header-tools">
            <a th:href="@{/cars/cost/add/{carId}(carId=${car.id})}" class="btn btn-primary">+ Dodaj koszt</a>
        </div>
    </div>
</header>

<section class="form-container">
    <form th:action="@{/cars/save}" th:object="${car}" method="post" novalidate>
        <input type="hidden" th:field="*{id}" />

        <div th:if="${#fields.hasErrors()}" class="flash" style="border-color:#fca5a5;background:#fef2f2;color:#991b1b;">
            Popraw zaznaczone pola formularza.
        </div>

        <div class="form-grid">
            <div class="section-box span-2">
                <div class="section-header">Dane pojazdu</div>
                <div class="subgrid">
                    <div class="field">
                        <label for="name">Nazwa <span class="req">*</span></label>
                        <input id="name" type="text" th:field="*{name}" maxlength="100" th:classappend="${#fields.hasErrors('name')} ? 'invalid'" required />
                        <div class="error" th:if="${#fields.hasErrors('name')}" th:errors="*{name}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="owner">Właściciel</label>
                        <input id="owner" type="text" th:field="*{owner}" maxlength="100" th:classappend="${#fields.hasErrors('owner')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('owner')}" th:errors="*{owner}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="brand">Marka <span class="req">*</span></label>
                        <input id="brand" type="text" th:field="*{brand}" maxlength="100" th:classappend="${#fields.hasErrors('brand')} ? 'invalid'" required />
                        <div class="error" th:if="${#fields.hasErrors('brand')}" th:errors="*{brand}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="model">Model <span class="req">*</span></label>
                        <input id="model" type="text" th:field="*{model}" maxlength="100" th:classappend="${#fields.hasErrors('model')} ? 'invalid'" required />
                        <div class="error" th:if="${#fields.hasErrors('model')}" th:errors="*{model}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="color">Kolor <span class="req">*</span></label>
                        <input id="color" type="text" th:field="*{color}" maxlength="50" th:classappend="${#fields.hasErrors('color')} ? 'invalid'" required />
                        <div class="error" th:if="${#fields.hasErrors('color')}" th:errors="*{color}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="registration">Rejestracja</label>
                        <input id="registration" type="text" th:field="*{registration}" pattern="^[A-Z0-9\-]{4,12}$" th:classappend="${#fields.hasErrors('registration')} ? 'invalid'" placeholder="np. WX12345" />
                        <div class="hint">Tylko A-Z, 0-9 i „-”, 4–12 znaków.</div>
                        <div class="error" th:if="${#fields.hasErrors('registration')}" th:errors="*{registration}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="vin">VIN</label>
                        <input id="vin" type="text" th:field="*{vin}" maxlength="17" pattern="^[A-HJ-NPR-Z0-9]{17}$" th:classappend="${#fields.hasErrors('vin')} ? 'invalid'" placeholder="17 znaków" />
                        <div class="hint">Bez I, O, Q. Automatycznie zamieniam na wielkie litery.</div>
                        <div class="error" th:if="${#fields.hasErrors('vin')}" th:errors="*{vin}">Błąd</div>
                    </div>
                </div>
            </div>

            <div class="field span-2">
                <label for="description">Opis</label>
                <textarea id="description" th:field="*{description}" maxlength="2000" rows="3" th:classappend="${#fields.hasErrors('description')} ? 'invalid'"></textarea>
                <div class="error" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">Błąd</div>
            </div>

            <div class="section-box span-2">
                <div class="section-header">Daty i przeglądy</div>
                <div class="subgrid" style="--cols: 3">
                    <div class="field">
                        <label for="review">Przegląd do</label>
                        <input id="review" type="date" th:field="*{review}" th:classappend="${#fields.hasErrors('review')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('review')}" th:errors="*{review}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="insured">Ubezpieczenie do</label>
                        <input id="insured" type="date" th:field="*{insured}" th:classappend="${#fields.hasErrors('insured')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('insured')}" th:errors="*{insured}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="year">Rok produkcji (data)</label>
                        <input id="year" type="date" th:field="*{year}" th:classappend="${#fields.hasErrors('year')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('year')}" th:errors="*{year}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="course">Przebieg (km)</label>
                        <input id="course" type="number" th:field="*{course}" min="0" max="3000000" step="1" th:classappend="${#fields.hasErrors('course')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('course')}" th:errors="*{course}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="courseDate">Data przebiegu</label>
                        <input id="courseDate" type="date" th:field="*{courseDate}" th:classappend="${#fields.hasErrors('courseDate')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('courseDate')}" th:errors="*{courseDate}">Błąd</div>
                    </div>
                </div>
            </div>

            <div class="section-box span-2">
                <div class="section-header">Serwis: rozrząd i olej</div>
                <div class="subgrid" style="--cols: 3">
                    <div class="field">
                        <label for="timingSystemIntervalKm">Interwał rozrządu (km)</label>
                        <input id="timingSystemIntervalKm" type="number" th:field="*{timingSystemIntervalKm}" min="0" max="1000000" step="1000" th:classappend="${#fields.hasErrors('timingSystemIntervalKm')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('timingSystemIntervalKm')}" th:errors="*{timingSystemIntervalKm}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="timingSystemCourse">Przebieg rozrządu (km)</label>
                        <input id="timingSystemCourse" type="number" th:field="*{timingSystemCourse}" min="0" max="3000000" step="100" th:classappend="${#fields.hasErrors('timingSystemCourse')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('timingSystemCourse')}" th:errors="*{timingSystemCourse}">Błąd</div>
                    </div>

                    <div class="field readonly">
                        <label>Pozostało do rozrządu</label>
                        <strong id="timingLeft" class="value">—</strong>
                    </div>

                    <div class="field">
                        <label for="oilChangeIntervalKm">Interwał oleju (km)</label>
                        <input id="oilChangeIntervalKm" type="number" th:field="*{oilChangeIntervalKm}" min="0" max="1000000" step="1000" th:classappend="${#fields.hasErrors('oilChangeIntervalKm')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('oilChangeIntervalKm')}" th:errors="*{oilChangeIntervalKm}">Błąd</div>
                    </div>

                    <div class="field">
                        <label for="oilChangeCourse">Przebieg wymiany oleju (km)</label>
                        <input id="oilChangeCourse" type="number" th:field="*{oilChangeCourse}" min="0" max="3000000" step="100" th:classappend="${#fields.hasErrors('oilChangeCourse')} ? 'invalid'" />
                        <div class="error" th:if="${#fields.hasErrors('oilChangeCourse')}" th:errors="*{oilChangeCourse}">Błąd</div>
                    </div>

                    <div class="field readonly">
                        <label>Pozostało do oleju</label>
                        <strong id="oilLeft" class="value">—</strong>
                    </div>
                </div>
            </div>

            <div class="section-box span-2">
                <div class="section-header">Koszyki</div>
                <div class="subgrid" style="--cols: 1">
                    <div class="field">
                        <label for="cart">Przypisane koszyki</label>
                        <select id="cart" th:field="*{cart}" multiple size="6" th:classappend="${#fields.hasErrors('cart')} ? 'invalid'">
                            <option th:each="c : ${allCarts}" th:value="${c.id}" th:text="${c.name}">Koszyk</option>
                        </select>
                        <div class="hint">Przytrzymaj Ctrl/Shift, aby wybrać wiele.</div>
                        <div class="error" th:if="${#fields.hasErrors('cart')}" th:errors="*{cart}">Błąd</div>
                    </div>
                </div>
            </div>

        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Zapisz</button>
            <a th:href="@{/cars}" class="btn btn-secondary">Anuluj</a>
        </div>
    </form>
</section>


<script th:src="@{/js/general.js}"></script>
</body>
</html>