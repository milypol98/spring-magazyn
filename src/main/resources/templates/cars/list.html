<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8" />
    <title>Pojazdy</title>
    <link rel="stylesheet" th:href="@{/css/cars.css}" />
</head>
<body>

<header class="page-header">
    <nav class="breadcrumbs" aria-label="breadcrumb">
        <a th:href="@{/}" class="crumb">Strona główna</a>
        <span class="sep">/</span>
        <span class="crumb current">Pojazdy</span>
    </nav>
    <div class="header-row">
        <h1 class="page-title">Lista pojazdów</h1>
        <div class="header-tools">
            <a th:href="@{/cars/add}" class="btn btn-primary">+ Dodaj pojazd</a>
        </div>
    </div>
</header>

<main class="content">
    <section class="card">
        <div class="table-header">
            <label class="table-title">Pojazdy</label>
            <input id="carsSearch" class="table-search" type="search" placeholder="Szukaj po rejestracji, marce, modelu…" />
        </div>

        <div class="table-wrapper">
            <table id="carsTable" class="table table-sortable">
                <thead>
                <tr>
                    <th data-sort="text">Rejestracja</th>
                    <th data-sort="text">Właściciel</th>
                    <th data-sort="text">Miejsce</th>
                    <th data-sort="text">Użytkownik</th>
                    <th data-sort="text">Marka</th>
                    <th data-sort="text">Model</th>
                    <th data-sort="date">Ubezpieczenie do</th>
                    <th data-sort="number">Ubezpieczenie</th>
                    <th data-sort="date">Przegląd do</th>
                    <th data-sort="number">Przegląd</th>
                    <th data-sort="number">Przebieg</th>
                    <th data-sort="date">Przebieg z dnia</th>
                    <th data-sort="number">Wymiana oleju</th>
                    <th data-sort="number">Wymiana rozrządu</th>
                    <th data-sort="text">Akcje</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="car : ${cars}"
    th:attr="
        data-oil-course=${car.oilChangeCourse},
        data-oil-int=${car.oilChangeIntervalKm},
        data-timing-course=${car.timingSystemCourse},
        data-timing-int=${car.timingSystemIntervalKm}">
    <td th:text="${car.registration}">WX 12345</td>
    <td th:text="${car.owner}">Właściciel</td>

    <!-- Dane bieżącego zadania z map prostych Stringów -->
    <td th:text="${currentTaskNameByCarId[car.id]}">—</td>
    <td th:text="${currentTaskUsersByCarId[car.id]}">—</td>

    <td th:text="${car.brand}">Marka</td>
    <td th:text="${car.model}">Model</td>
    <td class="insured-date" th:text="${car.insured}">2025-12-31</td>
    <td class="insurance-days sev-neutral">—</td>
    <td class="review-date" th:text="${car.review}">2025-12-31</td>
    <td class="review-days sev-neutral">—</td>

    <!-- ważne: ta komórka ma klasę .course, JS czyta z niej bieżący przebieg -->
    <td class="course" th:text="${car.course}">123000</td>

    <td th:text="${car.courseDate}">2025-01-01</td>
    <td class="oil-remaining sev-neutral">—</td>
    <td class="timing-remaining sev-neutral">—</td>

    <td class="actions">
        <a class="btn btn-primary btn-small" th:href="@{/cars/info/{id}(id=${car.id})}">Załadunek</a>
        <a class="btn btn-primary btn-small" th:href="@{/cars/edit/{id}(id=${car.id})}">Edycja</a>
        <a class="btn btn-primary btn-small" th:href="@{/cars/info/{id}(id=${car.id})}">Szczegóły</a>
        <a class="btn btn-primary btn-small" th:href="@{/cars/cost/add/{carId}(carId=${car.id})}">Koszty</a>
        <form th:action="@{/cars/delete/{id}(id=${car.id})}" method="post" class="inline-form" data-confirm="Usunąć to auto?">
            <button type="submit" class="btn btn-danger btn-small">Usuń</button>
        </form>
    </td>
</tr>
                <tr th:if="${#lists.isEmpty(cars)}">
                    <td colspan="15">Brak pojazdów.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>
</main>

<script th:src="@{/js/cars.js}"></script>
</body>
</html>
