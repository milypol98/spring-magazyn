<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pl">
<head>
    <meta charset="UTF-8" />
    <title>Faktura - dodaj/edytuj</title>
    <link rel="stylesheet" th:href="@{/css/general.css}" />
</head>
<body>
<header class="page-header">
    <nav class="breadcrumbs" aria-label="breadcrumb">
        <a th:href="@{/dashboard}" class="crumb">Strona główna</a>
        <span class="sep">/</span>
        <a th:href="@{/invoices}" class="crumb">Faktury</a>
        <span class="sep">/</span>
        <span class="crumb current" th:text="${invoice?.id} != null ? 'Edycja faktury' : 'Nowa faktura'">Faktura</span>
    </nav>
    <div class="header-row">
        <h1 class="page-title" th:text="${invoice?.id} != null ? 'Edycja faktury' : 'Nowa faktura'">Lista faktur</h1>
    </div>
</header>

<section class="form-container">
    <form th:action="@{/invoices/save}"
          method="post"
          enctype="multipart/form-data"
          class="card form">

        <div th:if="${error}" class="flash" style="border-color:#fca5a5;background:#fef2f2;color:#991b1b;" th:text="${error}">
            Wystąpił błąd
        </div>

        <div class="form-grid">
            <div class="field">
                <label for="invoiceNumber">Nr faktury <span class="req">*</span></label>
                <input id="invoiceNumber" type="text" name="nrFaktury" th:value="${nrFaktury}" placeholder="np. FV/01/2025" required />
            </div>

            <div class="field">
                <label for="name">Nazwa (kontrahent / tytuł) <span class="req">*</span></label>
                <input id="name" type="text" name="nazwa" th:value="${nazwa}" placeholder="np. Acme Sp. z o.o." required />
            </div>

            <div class="field">
                <label for="companyId">Firma (opcjonalnie)</label>
                <select id="companyId" name="companyId">
                    <option value="">-- Wybierz firmę --</option>
                    <option th:each="c : ${companies}"
                            th:value="${c.id}"
                            th:text="${c.name}"
                            th:selected="${companyId != null and c.id == companyId}">
                    </option>
                </select>
                <small style="display: block; margin-top: 4px;">
                    <a th:href="@{/companies/add}" target="_blank" rel="noopener">Dodaj nową firmę</a>
                </small>
            </div>

            <div class="field">
                <label for="currency">Waluta</label>
                <input id="currency" type="text" name="currency" th:value="${currency}" placeholder="np. PLN" />
            </div>

            <div class="field">
                <label for="totalNet">Netto</label>
                <input id="totalNet" type="number" step="0.01" name="totalNet" th:value="${totalNet}" placeholder="0.00" />
            </div>

            <div class="field">
                <label for="totalVat">VAT</label>
                <input id="totalVat" type="number" step="0.01" name="totalVat" th:value="${totalVat}" placeholder="0.00" />
            </div>

            <div class="field">
                <label for="totalGross">Brutto</label>
                <input id="totalGross" type="number" step="0.01" name="totalGross" th:value="${totalGross}" placeholder="0.00" />
            </div>

            <div class="field">
                <label for="file">Plik (PDF/skan) <span class="req">*</span></label>
                <input id="file" type="file" name="plik" accept=".pdf,image/*" required />
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Zapisz fakturę</button>
            <a th:href="@{/invoices}" class="btn btn-secondary">Anuluj</a>
        </div>
    </form>
</section>

<script th:src="@{/js/general.js}"></script>
<script th:src="@{/js/invoices.js}"></script>

</body>
</html>